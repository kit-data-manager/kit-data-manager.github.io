<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.8.dev">
<meta name="author" content="v{version}, KIT Data Manager Development Team, {date}">
<title>KIT Data Manager Documentation - Repository Service</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt,.quoteblock .quoteblock{margin:0 0 1.25em;padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>KIT Data Manager Documentation - Repository Service</h1>
<div class="details">
<span id="author" class="author">v{version}, KIT Data Manager Development Team, {date}</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#truerestful-api-description">RESTful API Description</a></li>
<li><a href="#trueintroduction">1. Introduction</a></li>
<li><a href="#ChapterDataResourceHandling">2. Data Resource Handling</a>
<ul class="sectlevel2">
<li><a href="#truecreating-a-data-resource">2.1. Creating a Data Resource</a></li>
<li><a href="#ChapterGetResource">2.2. Getting a Data Resource</a></li>
<li><a href="#trueupdating-a-data-resource">2.3. Updating a Data Resource</a>
<ul class="sectlevel3">
<li><a href="#truerules-for-applying-updates">2.3.1. Rules for Applying Updates</a></li>
</ul>
</li>
<li><a href="#truegetting-a-data-resource-by-an-alternate-identifier">2.4. Getting a Data Resource by an Alternate Identifier</a></li>
<li><a href="#trueuploading-data-for-a-data-resource">2.5. Uploading Data for a Data Resource</a></li>
<li><a href="#truelisting-content-information">2.6. Listing Content Information</a></li>
<li><a href="#truedownloading-data-from-a-data-resource">2.7. Downloading Data from a Data Resource</a></li>
<li><a href="#truedeleting-data-resources">2.8. Deleting Data Resources</a></li>
</ul>
</li>
<li><a href="#truemessaging-and-event-message-handling">Messaging and Event Message Handling</a>
<ul class="sectlevel1">
<li><a href="#trueintroduction-2">3. Introduction</a></li>
<li><a href="#truemessage-types-and-format">4. Message Types and Format</a></li>
<li><a href="#truemessaging-service-configuration">5. Messaging Service Configuration</a></li>
<li><a href="#trueadding-a-message-handler">6. Adding a Message Handler</a></li>
</ul>
</li>
<li><a href="#trueaudit-information-and-versioning-of-metadata-resources">Audit Information and Versioning of Metadata Resources</a>
<ul class="sectlevel1">
<li><a href="#trueintroduction-3">7. Introduction</a></li>
<li><a href="#trueaudit-information-and-versioning-configuration">8. Audit Information and Versioning Configuration</a></li>
<li><a href="#trueworking-with-versions-and-audit-information">9. Working with Versions and Audit Information</a></li>
<li><a href="#trueremarks-on-working-with-versions">10. Remarks on Working with Versions</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="truerestful-api-description"><a class="anchor" href="#truerestful-api-description"></a><a class="link" href="#truerestful-api-description">RESTful API Description</a></h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="trueintroduction"><a class="anchor" href="#trueintroduction"></a><a class="link" href="#trueintroduction">1. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this documentation, the basics of the KIT Data Manager RESTful API of the Repository Service are described. You will be guided through the first steps of creating a data resource,
listing existing resources and modifying a single resource on the metadata-level. Furthermore, the same operations on the data level are explained by example.</p>
</div>
<div class="paragraph">
<p>This documentation assumes, that you have an instance of the KIT Data Manager 2.0 Repository Service installed locally. If the repository is running on another
host or port you should change hostname and/or port accordingly. Furthermore, the examples assume that you are using the repository without authentication
and authorization, which is provided by another service. If you plan to use this optional service, please refer to its documentation first to see how the
examples in this documentation have to be modified in order to work with authentication. Typically, this should be achieved by simple adding an additional header
entry.</p>
</div>
<div class="paragraph">
<p>The example structure is identical for all examples below. Each example starts with a CURL command that can be run by copy&amp;paste to your console/terminal window.
The second part shows the HTTP request sent to the server including arguments and required headers. Finally, the third block shows the response comming from the server.
In between, special characteristics of the calls are explained together with additional, optional arguments or alternative responses.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For technical reasons, all metadata resources shown in the examples contain all fields, e.g. also empty lists or fields with value 'null'. You may ignore most of them
as long as they are not needed. Some of them will be assigned by the server, others remain empty or null as long as you don&#8217;t assign any value to them.
All fields mandatory at creation time are explained in the resource creation example.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ChapterDataResourceHandling"><a class="anchor" href="#ChapterDataResourceHandling"></a><a class="link" href="#ChapterDataResourceHandling">2. Data Resource Handling</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this first section, the handling of data resources on the metadata level is explained. It all starts with creating your first data resource. The resource model of
KIT Data Manager is based on the DataCite standard. Thus, also the mandatory elements defined by this standard are mandatory at creation time. The following elements
are expected to be provided by the user:</p>
</div>
<div class="ulist point">
<ul class="point">
<li>
<p>Title: At least one title element with arbitrary type (optional) and value must be present.</p>
</li>
<li>
<p>ResourceType: The resource type must be assigned by the user.</p>
</li>
<li>
<p>Creators: At least one creator must be present. If no creator is provided by the user, the server will use caller information for adding a creator.</p>
</li>
<li>
<p>Dates: One date of type CREATION must be part of every resource. If no such date is provided, the server will use the current date.</p>
</li>
<li>
<p>Publisher: The publisher of the resource must be set. If not, the server will use caller information.</p>
</li>
<li>
<p>PublicationYear: The publication year should be available. If not, the server will use the current year.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, mentioning how the server handles identifiers might be relevant. There are a couple of identifiers that can be assigned to the resource. The main
identifier is stored in the field 'identifier'. This field is allowed to hold a single identifier of type 'DOI' in case the resource has a valid DOI or a placeholder.
If the resource has a DOI assigned, this DOI will become the main identifier of the resource. If no 'identifier' is assigned or if the value of 'identifier' represents
a valid placeholder, the list of 'alternateIdentifiers' is checked for an element of type 'INTERNAL'. If one is provided by the user, the value of this element will
be the resource identifier as long as its a unique value. If no alternate identifier of type 'INTERNAL' is available, the server creates one with a UUID as value and uses
this value as resource identifier. Summarizing, this means:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If your resource has a DOI, provide the DOI as 'identifier'.</p>
</li>
<li>
<p>If your resource has no DOI, but should have a defined identifier, provide the identifier as 'alternateIdentifier' of type 'INTERNAL'.</p>
</li>
<li>
<p>If your resource has no DOI and its identifier can be arbitrary, omit any identifier field and leave it to the server to assign an identifier.</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="truecreating-a-data-resource"><a class="anchor" href="#truecreating-a-data-resource"></a><a class="link" href="#truecreating-a-data-resource">2.1. Creating a Data Resource</a></h3>
<div class="paragraph">
<p>The following example shows the creation of the first resource only providing mandatory fields:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/' -i -X POST \
    -H 'Content-Type: application/json' \
    -d '{
  "id" : null,
  "identifier" : null,
  "creators" : [ {
    "id" : null,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : null,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER",
    "lang" : null
  } ],
  "publisher" : null,
  "publicationYear" : null,
  "resourceType" : {
    "id" : null,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "subjects" : [ ],
  "contributors" : [ ],
  "dates" : [ ],
  "relatedIdentifiers" : [ ],
  "descriptions" : [ ],
  "geoLocations" : [ ],
  "language" : null,
  "alternateIdentifiers" : [ ],
  "sizes" : [ ],
  "formats" : [ ],
  "version" : null,
  "rights" : [ ],
  "fundingReferences" : [ ],
  "lastUpdate" : null,
  "state" : null,
  "embargoDate" : null,
  "acls" : [ ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see, that most of the sent document is empty. Only title, creator and resourceType are provided by the user. HTTP-wise the call looks as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">POST /api/v1/dataresources/ HTTP/1.1
Content-Type: application/json
Content-Length: 900
Host: localhost:8080

{
  "id" : null,
  "identifier" : null,
  "creators" : [ {
    "id" : null,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : null,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER",
    "lang" : null
  } ],
  "publisher" : null,
  "publicationYear" : null,
  "resourceType" : {
    "id" : null,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "subjects" : [ ],
  "contributors" : [ ],
  "dates" : [ ],
  "relatedIdentifiers" : [ ],
  "descriptions" : [ ],
  "geoLocations" : [ ],
  "language" : null,
  "alternateIdentifiers" : [ ],
  "sizes" : [ ],
  "formats" : [ ],
  "version" : null,
  "rights" : [ ],
  "fundingReferences" : [ ],
  "lastUpdate" : null,
  "state" : null,
  "embargoDate" : null,
  "acls" : [ ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As Content-Type only 'application/json' is supported and should be provided. The two other headers are typically set by the HTTP client. After validating the
provided document, adding missing information where possible and persisting the created resource, the result is sent back to the user and will look that way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 201 Created
Location: http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1
ETag: "-1239688335"
Resource-Version: 1
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1002

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "SELF",
  "publicationYear" : "2020",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:46.671Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>What you see is, that the result looks different from the original document. A few elements, e.g. identifier, alternateIdentifiers, publisher, publicationYear, dates, acls and state
received a value by the server. Furthermore, you&#8217;ll find an ETag header with the current ETag of the resource. This value is returned by POST, GET, PUT and PATCH calls and must be provided for
all calls modifying the resource, e.g. PATCH, PUT and DELETE, in order to avoid conflicts.</p>
</div>
</div>
<div class="sect2">
<h3 id="ChapterGetResource"><a class="anchor" href="#ChapterGetResource"></a><a class="link" href="#ChapterGetResource">2.2. Getting a Data Resource</a></h3>
<div class="paragraph">
<p>For obtaining accessible data resources you have multiple options: list all resources, access a single resource using a known identifier or search by example. The following example shows how to obtain a
single resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X GET</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the actual HTTP request there is nothing special. You just access the resource&#8217;s path using the base path and the resource identifier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result, you receive the JSON representation of the resource metadata and again the ETag in the HTTP response header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "-1239688335"
Resource-Version: 1
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1002

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "SELF",
  "publicationYear" : "2020",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:46.671Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Often, it is not enough to access either all resources or only one specific resources, but you want to search for resources following criterias you want to specify. This can be either done using an external service,
e.g. elasticseach, having all metadata registered or by using the built-in support for finding resources by example. The idea is to allow the user to submit a resource document having values assigned to
certain fields and to map this resource to a query on the database backend. The main advantage of this approach is its simplicity, the main disadvantage are very basic queries not allowing fine-grained
selection or other features provided if using a dedicated query language or a search index. That&#8217;s why for KIT Data Manager both approaches are supported, whereas only the search by example is described in this
document as setting up a search index is quite specific to the use case and will be covered in a separate document.</p>
</div>
<div class="paragraph">
<p>In order to find resources by example you simple have to POST a resource document all fields filled you want to search for to the endpoint shown in the following curl request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/search' -i -X POST \
    -H 'Content-Type: application/json' \
    -d '{
  "id" : null,
  "identifier" : null,
  "creators" : [ ],
  "titles" : [ ],
  "publisher" : null,
  "publicationYear" : null,
  "resourceType" : {
    "id" : null,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "subjects" : [ ],
  "contributors" : [ ],
  "dates" : [ ],
  "relatedIdentifiers" : [ ],
  "descriptions" : [ ],
  "geoLocations" : [ ],
  "language" : null,
  "alternateIdentifiers" : [ ],
  "sizes" : [ ],
  "formats" : [ ],
  "version" : null,
  "rights" : [ ],
  "fundingReferences" : [ ],
  "lastUpdate" : null,
  "state" : null,
  "embargoDate" : null,
  "acls" : [ ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In our example we search for resources of type DATASET with the type value 'testingSample'. All empty fields in the request can be omitted. You can also see that the endpoint 'dataresources/seach' is based on the
pattern for all other endpoints, so in that case we want to search for data resources. The result of the request will be either an empty response with no element or a list of matching resources.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Content-Range: 0-19/1
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1109

[ {
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "KIT Data Manager",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:47.814Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also in that case, pagination is supported which you can see in the response header containing the 'Content-Range' key. Internally, assigned values of the example are mapped to queries. Strings are mapped using 'LIKE'
expression with a wildcard character at the beginning and the end. Thus, in our example above also a type value of 'testing' would produce the same result.</p>
</div>
<div class="paragraph">
<p>Finding resources by example is supported for data resources as well as for content information. However, there are also some limitations in order to keep it simple and reproducible. The following tables show, which
attributes are evaluated in which way for creating queries to the data backend.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supported Data Resource Fields</th>
<th class="tableblock halign-left valign-top">Queried as&#8230;&#8203;</th>
<th class="tableblock halign-left valign-top">Match Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>publisher</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.publisher LIKE %value%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>publicationYear</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.publicationYear LIKE %value%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>language</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.language LIKE %value%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>version</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.version LIKE %value%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>state</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.state IN [value]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>resourceType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.resourceType.typeGeneral=resourceType.typeGeneral AND resource.resourceType.value LIKE %resourceType.value%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>creators</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Strings</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.creator.familyName LIKE %creators.familyName% OR resource.creator.givenName LIKE %creators.givenName% OR resource.creator.affiliation IN [creators.affiliation]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>primaryIdentifier</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.identifier.value IN [primaryIdentifier.value]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>alternateIdentifiers</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource.alternateIdentifier.identifierType!=INTERNAL AND resource.alternateIdentifier.value IN [alternateIdentifiers.value]</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Other fields will be supported in future. If you require a certain field by your use case. please feel free to file a feature request at GitHub.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Supported Content Information Fields</th>
<th class="tableblock halign-left valign-top">Queried as&#8230;&#8203;</th>
<th class="tableblock halign-left valign-top">Match Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>relativePath</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentInformation.relativePath LIKE %relativePath%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>contentUri</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentInformation.contentUri LIKE %contentUri%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>mediaType</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentInformation.mediaType LIKE %mediaType%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>metadata</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentInformation.metadata.key=metadata.key AND contentInformation.metadata.value LIKE %metadata.value%</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>tags</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">String</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">contentInformation.tags IN [tags]</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="trueupdating-a-data-resource"><a class="anchor" href="#trueupdating-a-data-resource"></a><a class="link" href="#trueupdating-a-data-resource">2.3. Updating a Data Resource</a></h3>
<div class="paragraph">
<p>The default way of updating resources' metadata in KIT Data Manager is by using HTTP PATCH. Therefor, JSON Patch documents following the RFC 6902 specification are sent to the server stating
which operation should be applied to which field with which value. A sample request is shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X PATCH \
    -H 'Content-Type: application/json-patch+json' \
    -H 'If-Match: "-1239688335"' \
    -d '[ {
  "op" : "replace",
  "path" : "/publicationYear",
  "value" : "2017"
} ]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this simple example we change the publicationYear property of a resource. Therefor, we are using the operation 'replace', the path '/publicationYear' and the new value "2017".
Thus, you need to know a few things in order to create a patch document:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Which operation should be used? - Please refer to the RFC 6902 specification for available operations.</p>
</li>
<li>
<p>Which path should be affected? - The path is defined by the model of KIT Data Manager&#8217;s data resources. If you want to modify an array you should know that the index starts with 0 and you should also know
the number of elements before the patch operation in order to add the new element to index current + 1.</p>
</li>
<li>
<p>Which kind of value must be provided? - Depending on the provided path you&#8217;ll either have to provide a primitive value, e.g. a string like "new value" or a number like 123, or you have to provide a JSON object.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As soon as you have created your patch document, you can send it to the server using the HTTP verb PATCH and the ETag of the resource. Furthermore, you have to provide the Content-Type 'application/json-patch+json'
in order to state that you&#8217;re sending a patch document. A valid request will then look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">PATCH /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
Content-Type: application/json-patch+json
If-Match: "-1239688335"
Content-Length: 81
Host: localhost:8080

[ {
  "op" : "replace",
  "path" : "/publicationYear",
  "value" : "2017"
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>If a patch could be applied, you&#8217;ll receive a response with HTTP status 204 (NO_CONTENT). If this is the case, you can assume that the resource has been changed. If the patch document was invalid, HTTP 400 (BAD_REQUEST)
will be returned.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 204 No Content
Resource-Version: 2
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you want to apply multiple patch operations you do not have to send one request per operation. Instead you can submit an array of patch operations within one single request. In case of a positive response of HTTP 204,
all patch operations have been applied.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you now request the patched resource you will see all modifications included:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X GET</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "71195522"
Resource-Version: 2
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1002

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "SELF",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:47.385Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the next example, a more complex patch operation is shown adding a new alternate identifier. We are using the patch operation 'add' affecting the path '/alternateIdentifiers/1' with a value containing a
JSON object representing the new identifier. Using the index 1 is because each resource has by default one alternate identifier of type INTERNAL assigned accessible at index 0. However, it&#8217;s more save to
check the resource first before trying to add a new element to an array in order to provide the correct index. Otherwise, if you try to add an element to an existing index, HTTP 400 (BAD_REQUEST) will be returned.
The request for adding a new alternate identifier should look as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X PATCH \
    -H 'Content-Type: application/json-patch+json' \
    -H 'If-Match: "71195522"' \
    -d '[ {
  "op" : "add",
  "path" : "/alternateIdentifiers/1",
  "value" : {
    "identifierType" : "OTHER",
    "value" : "resource-1-231118"
  }
} ]'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Bear also in mind, that the value of the patch operation contains a value matching the addressed path in the same format as it would be returned by the server. Thus, you don&#8217;t need any escaping of
array elements or numbers. Only strings have to be quoted. The HTTP request including the proper Content-Type and mandatory ETag is shown in the block below followed by the response we already know.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">PATCH /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
Content-Type: application/json-patch+json
If-Match: "71195522"
Content-Length: 152
Host: localhost:8080

[ {
  "op" : "add",
  "path" : "/alternateIdentifiers/1",
  "value" : {
    "identifierType" : "OTHER",
    "value" : "resource-1-231118"
  }
} ]</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 204 No Content
Resource-Version: 3
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now obtain the patched resource you&#8217;ll see that there are two alternate identifiers, the INTERNAL one and the identifier of type OTHER we just added.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X GET</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "-470411734"
Resource-Version: 3
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1093

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "SELF",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:47.612Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Besides the possiblity of patching resources there is also the option to apply updates to an existing resource via HTTP PUT. This rather traditional approach requires the user to read a resource,
apply updates locally and send the modified resource back to the server. This approach may seem more intuitive but can also causes a comparibly huge overhead as also unchanged content is sent between
client and server. To illustrate the impact, let&#8217;s go back to the update example in the beginning. In order to update the publication year the following requests are necessary:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTTP HEAD /api/v1/dataresources/f1062088-3946-410c-8d85-b64f3d6f0751 in order to obtain the current ETag w/o requesting the entire resource (not shown in the example)</p>
</li>
<li>
<p>HTTP PATCH /api/v1/dataresources/f1062088-3946-410c-8d85-b64f3d6f0751 sending 77 bytes of patch document</p>
</li>
<li>
<p>HTTP GET /api/v1/dataresources/f1062088-3946-410c-8d85-b64f3d6f0751 requesting 1202 bytes to read the resource after patching it (not necessary, just for a fair comparison)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Summarizing, approx. 1300 bytes of payload were transferred. If we now take a look at the same operation using HTTP PUT it looks as follows:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>HTTP GET /api/v1/dataresources/f1062088-3946-410c-8d85-b64f3d6f0751 requesting 1202 bytes to read the resource itself as we have to apply changes client-side and the current ETag and the</p>
</li>
<li>
<p>Apply changes locally, e.g. set the new publication year</p>
</li>
<li>
<p>HTTP PUT /api/v1/dataresources/f1062088-3946-410c-8d85-b64f3d6f0751 sending 1202 bytes of data containing the changed resource and receiving 1202 bytes of data (the modified resource) as response</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>You can see that in the second scenario the entire resource is sent three times summing up to around 3600 bytes of data. For a single requests this doesn&#8217;t seem to be much, but just imagine the overhead
produced by hundreds or thousands of users working actively with the system. Then a factor of three definitely matters.</p>
</div>
<div class="paragraph">
<p>However, let&#8217;s wrap this up with the example of the PUT operation being aware that it should only be used if there are good reasons to do so.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X PUT \
    -H 'Content-Type: application/json' \
    -H 'If-Match: "-470411734"' \
    -d '{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER",
    "lang" : null
  } ],
  "publisher" : "KIT Data Manager",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "subjects" : [ ],
  "contributors" : [ ],
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "relatedIdentifiers" : [ ],
  "descriptions" : [ ],
  "geoLocations" : [ ],
  "language" : null,
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "sizes" : [ ],
  "formats" : [ ],
  "version" : null,
  "rights" : [ ],
  "fundingReferences" : [ ],
  "lastUpdate" : "2020-12-08T09:24:47.612Z",
  "state" : "VOLATILE",
  "embargoDate" : null,
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}'</code></pre>
</div>
</div>
<div class="paragraph">
<p>As described before, the entire document is send with the PUT request including the current ETag of the resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">PUT /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
Content-Type: application/json
If-Match: "-470411734"
Content-Length: 1407
Host: localhost:8080

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER",
    "lang" : null
  } ],
  "publisher" : "KIT Data Manager",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "subjects" : [ ],
  "contributors" : [ ],
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "relatedIdentifiers" : [ ],
  "descriptions" : [ ],
  "geoLocations" : [ ],
  "language" : null,
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "sizes" : [ ],
  "formats" : [ ],
  "version" : null,
  "rights" : [ ],
  "fundingReferences" : [ ],
  "lastUpdate" : "2020-12-08T09:24:47.612Z",
  "state" : "VOLATILE",
  "embargoDate" : null,
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the updated resource is sent back to the user in the response body together with HTTP status 200 (OK) if the update was successful.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "-205501225"
Resource-Version: 4
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1105

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "KIT Data Manager",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:47.814Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="truerules-for-applying-updates"><a class="anchor" href="#truerules-for-applying-updates"></a><a class="link" href="#truerules-for-applying-updates">2.3.1. Rules for Applying Updates</a></h4>
<div class="paragraph">
<p>Before you try to update a certain resource and wonder why the update fails for unknown reasons, please check the following rules for updating resources as not all fields can be updated (by everybody).
These rules apply to both scenarios, updating via PATCH and PUT.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>It is NOT allowed to update any field named 'id'. This is for technical reasons as these ids are used internally for indexing and linking, therefore changes would influence the integrity of the system.</p>
</li>
<li>
<p>Performing updates requires WRITE permissions to the updated resource. This only applies if authorization is enabled, which is not part of this document. Without active authorization, each request is executed with WRITE permissions.</p>
</li>
<li>
<p>With WRITE permissions, Resources can only be updated as long as their state is VOLATILE. If the state is changed to FIXED, only the owner and administrators are allowed to update the resource. This only applies if authorization is enabled,
which is not part of this document. Without active authorization, the state has no influence.</p>
</li>
<li>
<p>The array 'acls' can only be changed by the owner or an administrator. This only applies if authorization is enabled, which is not part of this document. Without active authorization, acls have no influence.</p>
</li>
<li>
<p>Each value of 'identifier' and 'alternateIdentifiers' of all resources must be unique. This is due to the fact, that a resource can be accessed by all its identifiers and allowing duplicated identifiers would cause equivocal results.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If one of these rules is violated, an according HTTP status code is returned, e.g. BAD_REQUEST, FORBIDDEN or CONFLICT.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truegetting-a-data-resource-by-an-alternate-identifier"><a class="anchor" href="#truegetting-a-data-resource-by-an-alternate-identifier"></a><a class="link" href="#truegetting-a-data-resource-by-an-alternate-identifier">2.4. Getting a Data Resource by an Alternate Identifier</a></h3>
<div class="paragraph">
<p>Typically, the main identifier of the resource, stored in the 'id' field, is used to address a resource. As stated in chapter <a href="#ChapterDataResourceHandling">Data Resource Handling</a>
this main identifier is set at resource creation time, either from a provided DOI, a provided identifier of type INTERNAL or by the server. However, you can also use any other identifier to address a resource,
e.g. the DOI added at a later point or the value of another alternate identifier assigned to the resource. In the following example we are using the alternate identifier of type OTHER we just added
to the resource via patch operation. The request looks like a typical GET request:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/resource-1-231118' -i -X GET</code></pre>
</div>
</div>
<div class="paragraph">
<p>Also the HTTP request shows no difference compared to the GET request shown in the beginning:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/resource-1-231118 HTTP/1.1
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only difference is how the response looks like. If you are NOT using the main identifier you&#8217;ll not receive a direct response. Instead, HTTP 303 (SEE_OTHER) is returned together with the link
to the resource including the main identifier in the Location response header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 303 See Other
Location: http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1{?version}
Content-Type: text/plain;charset=UTF-8
Content-Length: 89
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY

http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1{?version}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, depending on the utilized HTTP client and its configuration, the redirect might be executed immediately such that you won&#8217;t be able to spot any difference compared to the direct request
using the main identifier of the resource.</p>
</div>
</div>
<div class="sect2">
<h3 id="trueuploading-data-for-a-data-resource"><a class="anchor" href="#trueuploading-data-for-a-data-resource"></a><a class="link" href="#trueuploading-data-for-a-data-resource">2.5. Uploading Data for a Data Resource</a></h3>
<div class="paragraph">
<p>After covering the basics of metadata creation and modification it&#8217;s time to associate the first file with a created data resource. Uploading data to a KIT Data Manager based repository is also
done using the RESTful API. In order to inform the repository to access data or data-related metadata, you only have to append a path element 'data' to the URL of the actual resource. After this
'data' path element you are free to organize and name your data as you wish. This allows you to build filesystem-like hierarchies for each data resource. Furthermore, with each file uploaded to
KIT Data Manager a metadata document is connected called 'ContentInformation'. This document contains internal information, e.g. the relative path, the depth in the hierarchy and the parent resource,
automatically generated metadata, e.g. checksum, size and mime type information, as well as custom information that can be added by the user, e.g. key-value based metadata or tags for grouping content elements.
For the time being, let&#8217;s stick with the simple case of uploading a single file you can see in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt' -i -X POST \
    -H 'Content-Type: multipart/form-data' \
    -F 'file=@randomFile.txt;type=multipart/form-data'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should pay attention to three different things: first, check the URL. You can see the base URL for the resource we&#8217;ve created before with the aforementioned 'data' element and a filename 'randomFile.txt'.
This will be the URL where the file is uploaded to and from where it can be downloaded later. The second part worth mentioning is the Content-Type header which is set to 'multipart/form-data'. You always have
to provide this content type while uploading data, otherwise the upload will fail. Finally, there is the file to upload. For the curl command, it must be provided in the way shown in the example with the -F
command line option, the argument name 'file' and the reference to the local file, in this example '@randomFile.txt'. How you provide this argument depends on the client or the API you are using.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In the example, the local source file and the destination file name at the server are both 'randomFile.txt'. This is not necessarily required. There can be used an arbitrary name for the file on the server
independent from the original file name.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>In the HTTP request you can see how the data is submitted. You have your part boundary surrounding the actual content of the file in an encoded form.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">POST /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt HTTP/1.1
Content-Type: multipart/form-data; boundary=6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Host: localhost:8080

--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Content-Disposition: form-data; name=file; filename=randomFile.txt
Content-Type: multipart/form-data

CHfnusrLNh8yEuzEx676A1syEnqZaY8ziZGpj34G1DdQyYjN6GOpaBtrGGemPAnu
--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm--</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, if the file has been uploaded, a response with HTTP status 201 (CREATED) is returned together with the file access URL in the Location header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 201 Created
Location: http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt?version=1
Resource-Version: 1
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
<div class="paragraph">
<p>Via the file location you can access both: the bitstream of the file as well as metadata collected during file ingest.
Let&#8217;s first take a look at the metadata. Therefor, you have to do a simple HTTP GET to the data location telling the server that you request for metadata by adding the Accept header with the value
'application/vnd.datamanager.content-information+json' as you can see it in the curl command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt' -i -X GET \
    -H 'Accept: application/vnd.datamanager.content-information+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>The HTTP request holds no surprises, it contains the provided target URL as well as the Accept header for requesting ContentInformation instead of data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt HTTP/1.1
Accept: application/vnd.datamanager.content-information+json
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>With the response you receive on the one hand the current ETag and on the other hand the actual ContentInformation document for the addressed file. All information you can see in the following response
is added by the server during the file ingest.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "-205501225"
Resource-Version: 1
Content-Type: application/vnd.datamanager.content-information+json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 761

{
  "id" : 1,
  "parentResource" : {
    "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifier" : {
      "value" : "(:tba)",
      "identifierType" : "DOI"
    },
    "alternateIdentifiers" : [ {
      "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
      "identifierType" : "INTERNAL"
    } ]
  },
  "relativePath" : "randomFile.txt",
  "version" : 1,
  "fileVersion" : "1",
  "versioningService" : "none",
  "depth" : 1,
  "contentUri" : "file:/tmp/'2020'/683ae98f-a663-4dd9-8f20-0dcde71c37a1/randomFile.txt_1607419488367",
  "uploader" : "SELF",
  "mediaType" : "text/plain",
  "hash" : "sha1:b69b09fc5dc3beb25376cab82017b6b1bf561610",
  "size" : 64,
  "metadata" : { },
  "tags" : [ ],
  "filename" : "randomFile.txt"
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Of course, you can also provide a ContentInformation document during upload, e.g. if you plan to add key-value metadata or tags for a file. In that case you basically do the same as before but you also add
another file argument with name 'metadata' containing a JSON file with the ContentInformation document.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile2.txt' -i -X POST \
    -H 'Content-Type: multipart/form-data' \
    -F 'file=@randomFile2.txt;type=multipart/form-data' \
    -F 'metadata=@metadata.json;type=application/json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the HTTP request you now see two content elements: the file 'randomFile2.txt' and the metadata 'metadata.json'. You can choose an arbitrary name for the metadata file, but the content must match the
ContentInformation model. In the example you see what&#8217;s in the metadata file. The only element that is relevant is 'metadata' containing a single key 'test' with value 'ok'. There are also other elements
in this file, e.g. depth, size and filename. These are examples for content metadata elements that cannot be set by the user. If there is a value assigned, it will be overwritten during ingest with one
exception explained later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">POST /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile2.txt HTTP/1.1
Content-Type: multipart/form-data; boundary=6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Host: localhost:8080

--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Content-Disposition: form-data; name=file; filename=randomFile2.txt
Content-Type: multipart/form-data

CHfnusrLNh8yEuzEx676A1syEnqZaY8ziZGpj34G1DdQyYjN6GOpaBtrGGemPAnu
--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Content-Disposition: form-data; name=metadata; filename=metadata.json
Content-Type: application/json

{"versioningService":"none","depth":0,"size":0,"metadata":{"test":"ok"},"tags":[]}
--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm--</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response of the upload including content information is identical to the first upload example. If an HTTP status 201 (CREATED) is returned, everything worked out fine and the file as well as the
ContentInformation document can be accessed via the Location provided in the header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 201 Created
Location: http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile2.txt?version=1
Resource-Version: 1
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, in some cases, it might not be possible or desired to upload a certain file to the repository, e.g. due to size limitations or due to licensing issues. For these cases it is possible, to just register
a remotely stored file at the local repository. In this scenario, the file argument is omitted during upload and only the ContentInformation metadata document is submitted containing the remote URL in the
'contentUri' field as you can see it in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/referencedContent' -i -X POST \
    -H 'Content-Type: multipart/form-data' \
    -F 'metadata=@metadata.json;type=application/json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is another exception in this special scenario. As there is no guarantee that the file referenced by 'contentUri' is accessible by the repository and for performance reasons, the file is neither checked
nor downloaded at ingest time. Therefore, no size or checksum information will be assigned by the system. If you are aware of these information and if you want to make them available, it is allowed to
provide the size and checksum element of the ContentInformation document at upload time. They are (only in this case) not overwritten and will be available later, no matter if they are correct or not.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">POST /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/referencedContent HTTP/1.1
Content-Type: multipart/form-data; boundary=6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Host: localhost:8080

--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm
Content-Disposition: form-data; name=metadata; filename=metadata.json
Content-Type: application/json

{"versioningService":"none","depth":0,"contentUri":"https://www.google.com","size":0,"metadata":{},"tags":[]}
--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm--</code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, the response of the 'virtual upload' looks as before. However, please keep in mind that there are NO CHECKS of what&#8217;s behind the contentUri. This happens only at download time, which will be the next
example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 201 Created
Location: http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/referencedContent?version=1
Resource-Version: 1
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="truelisting-content-information"><a class="anchor" href="#truelisting-content-information"></a><a class="link" href="#truelisting-content-information">2.6. Listing Content Information</a></h3>
<div class="paragraph">
<p>If you just uploaded the data you still have the data access URL in the Location header of the upload response. However, if you are not the uploader you have to check first, which files are associated with a
resource in order to obtain a data access URL before download. This can be done by submitting an HTTP GET request to an arbitraty 'virtual folder' as shown in the next example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/' -i -X GET \
    -H 'Accept: application/vnd.datamanager.content-information+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>This request will return all content information associated with the addressed resource as we perform a listing of the root data folder. By providing the Accept header with a value 'application/vnd.datamanager.content-information+json'
we ask for ContentInformation metadata as we&#8217;ve learned before. Currently, it is NOT possible to access a 'virtual folder' without providing this header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/ HTTP/1.1
Accept: application/vnd.datamanager.content-information+json
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the response we get all ContentInformation entries starting with the accessed path. As we provided the root path of the resource&#8217;s data, we receive all three content elements we&#8217;ve uploaded until now.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Content-Type: application/vnd.datamanager.content-information+json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 2121

[ {
  "id" : 1,
  "parentResource" : {
    "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifier" : {
      "value" : "(:tba)",
      "identifierType" : "DOI"
    },
    "alternateIdentifiers" : [ {
      "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
      "identifierType" : "INTERNAL"
    } ]
  },
  "relativePath" : "randomFile.txt",
  "version" : 1,
  "fileVersion" : "1",
  "versioningService" : "none",
  "depth" : 1,
  "contentUri" : "file:/tmp/'2020'/683ae98f-a663-4dd9-8f20-0dcde71c37a1/randomFile.txt_1607419488367",
  "uploader" : "SELF",
  "mediaType" : "text/plain",
  "hash" : "sha1:b69b09fc5dc3beb25376cab82017b6b1bf561610",
  "size" : 64,
  "metadata" : { },
  "tags" : [ ],
  "filename" : "randomFile.txt"
}, {
  "id" : 2,
  "parentResource" : {
    "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifier" : {
      "value" : "(:tba)",
      "identifierType" : "DOI"
    },
    "alternateIdentifiers" : [ {
      "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
      "identifierType" : "INTERNAL"
    } ]
  },
  "relativePath" : "randomFile2.txt",
  "version" : 1,
  "fileVersion" : "1",
  "versioningService" : "none",
  "depth" : 1,
  "contentUri" : "file:/tmp/'2020'/683ae98f-a663-4dd9-8f20-0dcde71c37a1/randomFile2.txt_1607419488602",
  "mediaType" : "text/plain",
  "hash" : "sha1:b69b09fc5dc3beb25376cab82017b6b1bf561610",
  "size" : 64,
  "metadata" : {
    "test" : "ok"
  },
  "tags" : [ ],
  "filename" : "randomFile2.txt"
}, {
  "id" : 3,
  "parentResource" : {
    "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifier" : {
      "value" : "(:tba)",
      "identifierType" : "DOI"
    },
    "alternateIdentifiers" : [ {
      "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
      "identifierType" : "INTERNAL"
    } ]
  },
  "relativePath" : "referencedContent",
  "version" : 1,
  "fileVersion" : "1",
  "versioningService" : "none",
  "depth" : 1,
  "contentUri" : "https://www.google.com",
  "size" : 0,
  "metadata" : { },
  "tags" : [ ],
  "filename" : "referencedContent"
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>Listing ContentInformation also support pagination. Furthermore, the results are sorted by their depth within the entire hierarchy of the resource&#8217;s content. This means, when listing the root folder of a complex content hierarchy,
you&#8217;ll first receive all elements directly located at the root folder followed by all elements located in folders of the first hierarchy level and so on.</p>
</div>
<div class="paragraph">
<p>In addition, you can provide a tag as query argument in order to return only elements having this tag assigned. This allows you to overlay different hierarchies easily and perform a very selective listing of elements.</p>
</div>
</div>
<div class="sect2">
<h3 id="truedownloading-data-from-a-data-resource"><a class="anchor" href="#truedownloading-data-from-a-data-resource"></a><a class="link" href="#truedownloading-data-from-a-data-resource">2.7. Downloading Data from a Data Resource</a></h3>
<div class="paragraph">
<p>After explaining how metadata and data are put into the system, let&#8217;s give a brief overview on downloading content. Actually, it&#8217;s just putting the file URL received during upload to the browser address bar or
to issue a GET request without Accept header as you can see in the curl command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt' -i -X GET</code></pre>
</div>
</div>
<div class="paragraph">
<p>There is not much to say about the HTTP request as it only contains the location of the data&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1/data/randomFile.txt HTTP/1.1
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;and the response contains the content of the file. That&#8217;s all in case the file is located at the repository.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Content-Type: text/plain
Content-Length: 64
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY

CHfnusrLNh8yEuzEx676A1syEnqZaY8ziZGpj34G1DdQyYjN6GOpaBtrGGemPAnu</code></pre>
</div>
</div>
<div class="paragraph">
<p>If the content is not located at the repository but referenced from remote, there are plenty of possible responses depending on the availability of the referenced content. While accessing references content,
the repository tries to issue an HTTP GET to the content URI. Depending on the response status received from the remote service, the repository responds as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Response from Remote Service</th>
<th class="tableblock halign-left valign-top">Response by Repository</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>None</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SERVICE_UNAVAILABLE (503)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>OK (200)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SEE_OTHER (303) with Content URI in 'Location' header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOVED_PERMANENTLY (301), FOUND (302), SEE_OTHER (303),TEMPORARY_REDIRECT (307), PERMANENT_REDIRECT (308) with 'Location' header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Previous response status with Content URI in 'Location' header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>MOVED_PERMANENTLY (301), FOUND (302), SEE_OTHER (303),TEMPORARY_REDIRECT (307), PERMANENT_REDIRECT (308) without 'Location' header</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">INTERNAL_SERVER_ERROR (500)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>All other status codes including UNAUTHORIZED (401) and FORBIDDEN (403)</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NO_CONTENT (204) with Content URI in 'Content-Location' header</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In all cases where the Location header is set, your HTTP client may redirect you immediately to the correct URL, so you probably won&#8217;t recognize any difference compared to direct data access. If you receive status
 SERVICE_UNAVAILABLE (503) or INTERNAL_SERVER_ERROR (500) there is (currently) no chance to receive the data you&#8217;ve requested. If you receive status NO_CONTENT (204) you should check for the Content-Location header in order
to try to access the data manually. There are two situations where manual access might be promising:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The remote server returned HTTP UNAUTHORIZED (401) or FORBIDDEN (403) as access requires custom authentication. If you own appropriate credentials, you can access the content after proper authentication.</p>
</li>
<li>
<p>If the content is not accessed via HTTP(s) you may use a custom data access client capable of opening a data stream to the content URI.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Beside of downloading single files, it&#8217;s also possible to download all data of one resource or virtual subfolders. Let&#8217;s assume you&#8217;ve organized a resource in the following way:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="http://localhost:65458/afx/cache/5c28a2c96fdd4ddf7da6b31906218201.png" alt="5c28a2c96fdd4ddf7da6b31906218201">
</div>
</div>
<div class="paragraph">
<p>With this structure, your are able to dowload either the entire content by addressing '/', only all experiment data by addressing 'experiment' or only the 'log' folder. In order to do so, you just address a virtual folder the same way you
would address a single file, e.g.</p>
</div>
<div class="paragraph">
<p>Download all content:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/56433955-2015-468c-b652-79657779bcf9/data/' -i -X GET \
    -H 'Accept: application/zip'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download only experiment data:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/56433955-2015-468c-b652-79657779bcf9/data/experiment/' -i -X GET \
    -H 'Accept: application/zip'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Download only logs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/56433955-2015-468c-b652-79657779bcf9/data/log/' -i -X GET \
    -H 'Accept: application/zip'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see, that the only differences compared to a single file download are the URLs ending with a slash, in order to address a virtual folder, and the provided content type in the 'Accept' header. In the example above, 'application/zip'
indicates that all content within the addressed folder is downloaded in a single ZIP archive. Currently, the following content types are supported:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Content Type</th>
<th class="tableblock halign-left valign-top">Format</th>
<th class="tableblock halign-left valign-top">Availability</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application/zip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File with zip compression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Part of default KIT DM 2.0 instance</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>application/vnd.datamanager.bagit+zip</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">BagIt file following the recommendations of the RDA Research Data Repository Interoperability Working Group with zip compression</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Available via plugin (see <a href="https://github.com/kit-data-manager/bagit-provider-plugin">bagit-provider-plugin</a>)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="truedeleting-data-resources"><a class="anchor" href="#truedeleting-data-resources"></a><a class="link" href="#truedeleting-data-resources">2.8. Deleting Data Resources</a></h3>
<div class="paragraph">
<p>Finally, after presenting several creation and access scenarios, let&#8217;s briefly cover the removal of resources. First things first, it is NOT possible to permanently remove resources via the RESTful API. The DELETE operation
is implemented in a way of revoking resources to make them invisible to users, but as they might be references internally or externally, they are never removed from the system unless using additional tools. The following request
shows how a DELETE operation is performed on an existing resource.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X DELETE \
    -H 'If-Match: "-205501225"'</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can see that you need the resource URL as well as the current ETag.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">DELETE /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
If-Match: "-205501225"
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The server responds with status HTTP NO_CONTENT (204) to all returning delete requests, even if the resource has been deleted already.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 204 No Content
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
<div class="paragraph">
<p>As soon as the resource was REVOKED, no user will be able to see or access the resource. A request to the resource URL will result in an HTTP status NOT_FOUND (404).
However, revoked resources are still visible to the owner(s) of the resource (person(s) possessing ADMINISTATE permission) or the system administrator (person(s) possessing the ADMINISTRATOR role). They still can access
and modify the resource, e.g. in order to change back the state to VOLATILE or FIXED in order to 'undo' the deletion.</p>
</div>
<div class="paragraph">
<p>If no authentication is enabled, which is assumed by this documentation, the deletion of resources only changes the state to REVOKED. The system account used for authentication-less access is automatically the owner
of all resources, which grants this account the access even to revoked resources. This is shown in the following example.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X GET</code></pre>
</div>
</div>
<div class="paragraph">
<p>We are trying a normal HTTP GET to the resource we just deleted. According to the description above, we should receive a positive response showing us a resource with state REVOKED.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response looks as expected. The resource we&#8217;ve deleted with the changed state.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "-179652677"
Resource-Version: 5
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1104

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "KIT Data Manager",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:49.129Z",
  "state" : "REVOKED",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>That&#8217;s the reason why another resource state has been introduced in case a resource should be hidden entirely from all users. This state is called GONE and is assigned if a revoked resource is deleted by
an ADMINISTRATOR. Of course, the GONE state can also be assigned via PATCH operation, but deleting a resource twice is the typical approach to do so. Let&#8217;s try applying a delete operation a second time.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">DELETE /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
If-Match: "-179652677"
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>The response looks as expected delivering status status HTTP NO_CONTENT (204).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 204 No Content
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if we now try to access the resource again via HTTP GET&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">GET /api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1 HTTP/1.1
Host: localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>&#8230;&#8203;we&#8217;ll receive nothing but the status HTTP NOT_FOUND (404). From now on, the resource is no longer accessible by anybody via RESTful endpoints. The only possibility to re-allow resource access is to modify its state
in the database.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
In contrast to deleting entire resource, deleting single content elements is permanent. If you send a DELETE request to a data URL of a resource, the associated file and all metadata associated with the particular
element are deleted. This operation is not reversible and you should double check before deleting a content element.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<h1 id="truemessaging-and-event-message-handling" class="sect0"><a class="anchor" href="#truemessaging-and-event-message-handling"></a><a class="link" href="#truemessaging-and-event-message-handling">Messaging and Event Message Handling</a></h1>
<div class="sect1">
<h2 id="trueintroduction-2"><a class="anchor" href="#trueintroduction-2"></a><a class="link" href="#trueintroduction-2">3. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a data repository creating a resource and uploading data is only the simplest workflow. In many cases, additional steps have to be performed in order to obtain all required information, to validate an upload or
to monitor what happens. For this purpose, KIT Data Manager offers a feature called 'messaging' emitting small messages after certain operations have succeeded. The following chapters describe how these messages
are look like, when they are emitted and how to deal with them in order to react on certain repository events.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truemessage-types-and-format"><a class="anchor" href="#truemessage-types-and-format"></a><a class="link" href="#truemessage-types-and-format">4. Message Types and Format</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are different kinds of messages grouped by category. Depending on its category, a message may contain additional properties or not. The following table shows all currently available message categories and the
condition under which a message with a certain category is sent.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">category[.subcategory]</th>
<th class="tableblock halign-left valign-top">Sent if&#8230;&#8203;</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a data resource has been created.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>create.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a new content element has been uploaded.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>update</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a data resource has been updated via PUT or PATCH.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>update.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;the metadata of a content element has been updated via PATCH.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>update.acl</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;an access control list element of a data resource has been updated via PATCH.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a data resource has been physically deleted (not implemented, yet).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>delete.data</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a content element has been deleted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>fix</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a data resource has been changed to FIXED state.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>revoke</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;a data resource has been changed to REVOKED state.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Apart from the category (and an optional sub category) each message holds the associated resource identifier as 'entityId' as well as the caller as 'principal' and a timestamp when the message was created. In addition, all
messages in the 'data' subcategory also contain 'contentPath', 'contentUri' and 'contentType' information as 'metadata' in order to allow quick decisions on whether a message should be handled or not.
The following snipped shows a sample message emitted after creating a new content element.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">{
"principal":"SELF",
"sender":"localhost",
"timestamp":1551963353619,
"entityId":"test123",
"action":"create",
"subCategory":"data",
"metadata":
{
"contentPath":"folder/image.png",
"contentUri":"file:///mnt/data/repository/2019/test123/image.png_1234412332",
"contentType":"image/png"
}
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will find all default elements mentioned above as well as the 'metadata' elements containing additional metadata specific to messages from the 'data' sub category. Messages are created by the repository as soon as
the operation they are related to has successfully finished, jut before returning the result to the user. Therefor, a Message Queue service called RabbitMQ is used, which has to be installed in addition to the database
and the repository microservice itself in order to be able to exchange messages.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="truemessaging-service-configuration"><a class="anchor" href="#truemessaging-service-configuration"></a><a class="link" href="#truemessaging-service-configuration">5. Messaging Service Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>In order to make use of the messaging feature, a RabbitMQ instance must be running, preferably locally for security reasons. Please refer to the RabbitMQ web page (<a href="https://www.rabbitmq.com/" class="bare">https://www.rabbitmq.com/</a>) on how to install and
operate such an instance. From the repository perspective, all relevant settings are part of the default configuration file 'application.properties'. These properties, their function and values/defaults are listed
in the following table. Typically, no additional repository-specific configuration of the message queue is necessary.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">property key</th>
<th class="tableblock halign-left valign-top">function</th>
<th class="tableblock halign-left valign-top">allowed values [default]</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.messaging.enabled</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enables (true) or disables (false) the entire messaging functionality.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true or false [true]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.messaging.hostname</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The hostname where the RabbitMQ instance is running at.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A valid hostname [localhost]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.messaging.port</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port on which the RabbitMQ instance is running at.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A numeric port number [5672]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.messaging.binding.exchange</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The RabbitMQ exchange to which all messages are sent.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string uniquely identifying the exchange [repository_events]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.messaging.binding.queue</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the queue collecting all messages of the exchange. This queue is used for all handlers installed at the repository itself. External consumers may create an own quene.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string uniquely identifying the queue [repoEventQueue]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.messaging.binding.routingKeys</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The routing key (category.[subcategory] of messages) sent to the configured queue.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A String containing the category (e.g. 'dataresource') and subcategory (e.g. '#' for all) [dataresources.\#]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>repo.schedule.rate</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The schedule rate in milliseconds at which the repository checks for new messages.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A numeric amount of milliseconds [1000]</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="trueadding-a-message-handler"><a class="anchor" href="#trueadding-a-message-handler"></a><a class="link" href="#trueadding-a-message-handler">6. Adding a Message Handler</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>There are multiple possibilities to consume messages from a server supporting the Advanced Message Queuing Protocol (AMQP) like RabbitMQ. In this documentation, we&#8217;ll describe how to do this using the built-in messaging support.
Therefore, it&#8217;s beneficial if you already have some programming experiences, preferably in Java.
In the code repository there exists an example handler which is part of this project: <a href="https://github.com/kit-data-manager/generic-message-consumer" class="bare">https://github.com/kit-data-manager/generic-message-consumer</a></p>
</div>
<div class="paragraph">
<p>You may now open your preferred development environment and clone the project from GitHub.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Before you continue you should also clone and build the service-base project (<a href="https://github.com/kit-data-manager/service-base" class="bare">https://github.com/kit-data-manager/service-base</a>) as it is a required dependency of the generic-message-consumer project.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After building the generic-message-consumer project, the sample-handler project can be opened from the same project folder. This project consists of one source file named 'LoggingMessageHandler.java' implementing the 'IMessageHandler' interface.
This interface offers three methods, whereas two have to be implemented:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>getHandlerIdentifier(): This method allows to (optionally) return a custom handler identifier, e.g. a unique name and implementation version. By default, the class name is returned.</p>
</li>
<li>
<p>configure(): This method is called at instantiation time and allows loading and validating handler-specific properties. The handler will be available only if configure() returns 'true'. Otherwise, the handler is deactivated.</p>
</li>
<li>
<p>handle(BasicMessage message): This method is called for each and every message received by the repository&#8217;s message queue. Thus, a handler should decide first if the message should be handled or not. If not, it might be rejected.</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-none hljs">@Component
public class LoggingMessageHandler implements IMessageHandler{

  private static final Logger LOGGER = LoggerFactory.getLogger(LoggingMessageHandler.class);

  @Override
  public RESULT handle(BasicMessage message){
    LOGGER.debug("Successfully received message {}.", message);
	//Typically, we should now return 'RESULT.SUCCEEDED' as we successfully processed the message.
    //However, as we actually did not touch the message we pretend to reject the message. Thus,
    //the message receiver won't expect the message to be handled successfully if this sample
    //handler is the only working handler installed, while all other handlers are failing.
    return RESULT.REJECTED;
  }

  @Override
  public boolean configure(){
    //no configuration necessary
    return true;
  }

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>The code snippet above shows the implementation of the aforementioned interface for the sample-handler. You can see that no configuration is needed for this handler, 'getHandlerIdentifier' is not overwritten, therefore the default identifier
is 'LoggingMessageHandler' and the only thing which is done is logging the message. One remarkable thing of this sample is the return value of the 'handle' method. As described in the code comment, we return REJECTED in order to not mark the
message as 'handled' in the scheduler. The reason for doing this can be clarified by the following description of the scheduling process:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The scheduler polls every second (default, can be changed in application.properties) for the next message in the queue.</p>
</li>
<li>
<p>The message is presented to all successfully configured handlers.</p>
</li>
<li>
<p>The first handler which returns 'SUCCEEDED' activates a flag 'messageHandledByOne'.</p>
</li>
<li>
<p>If a handler returns 'FAILED', the message and the handler name are preserved in a file called 'failed_message_handles.csv' for later processing. If this succeeds once, the flag 'messageHandledByOne' is also set.</p>
</li>
<li>
<p>If 'REJECTED' is returned by a handler, the scheduler proceeds to the next handler without setting the flag 'messageHandledByOne' nor preserving the message.</p>
</li>
<li>
<p>If the flag 'messageHandledByOne' is not set after all handlers were called, the message is logged to the logfile as debug entry and will be discarded.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Thus, if we in our sample handler wouldn&#8217;t return 'REJECTED', our status would influence how the scheduler deals with the message based on our response, which is nothing we want for a handler only logging the message.</p>
</div>
<div class="paragraph">
<p>After implementing a custom message handler you have to build a jar file and place it, together with all required dependencies, in the extensions folder of your KIT DM 2.0 installation. If your handler needs any configuration,
it is recommended to place it in the current working directory at service startup, which is typically the folder where 'base-repo.jar' is located.</p>
</div>
</div>
</div>
<h1 id="trueaudit-information-and-versioning-of-metadata-resources" class="sect0"><a class="anchor" href="#trueaudit-information-and-versioning-of-metadata-resources"></a><a class="link" href="#trueaudit-information-and-versioning-of-metadata-resources">Audit Information and Versioning of Metadata Resources</a></h1>
<div class="sect1">
<h2 id="trueintroduction-3"><a class="anchor" href="#trueintroduction-3"></a><a class="link" href="#trueintroduction-3">7. Introduction</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Not only in living data repositories metadata (and sometimes also data) are subject of change, either by a user or in the course of curation activities. For validation and documentation purposes it can be desirable
to keep track of these changes, either for monitoring or to be able to rollback unwanted changes at a later point in time. Therefor, KIT Data Manager offers support for capturing audit information and versioning of
metadata documents. It uses the JaVers library (<a href="https://javers.org/" class="bare">https://javers.org/</a>) to collect changes between two versions of one document and stores this information in a relational database. With the collected changes
JaVers is capable of creating so called 'Shadows' of a document, which are representing a version at a specific point in time.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueaudit-information-and-versioning-configuration"><a class="anchor" href="#trueaudit-information-and-versioning-configuration"></a><a class="link" href="#trueaudit-information-and-versioning-configuration">8. Audit Information and Versioning Configuration</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Enabling or disabling the audit and versioning feature can be done easily by setting the value of the property 'repo.audit.enabled' inside 'application.properties' either 'true' or 'false'. All audit information is stored
in the same database configured for the repository, therefore, no additional configuration is needed. If the feature was not enabled, yet, you can enable it at any time to start capturing audit information beginning with
the next restart of the repository service. You may also disable the feature again, e.g. temporarily to avoid capturing information, as the primary version of a resource is stored at the repository.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueworking-with-versions-and-audit-information"><a class="anchor" href="#trueworking-with-versions-and-audit-information"></a><a class="link" href="#trueworking-with-versions-and-audit-information">9. Working with Versions and Audit Information</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Audit and versioning support are seamlessly integrated into the internal workflows and you can benefit from it easily. If you go back to the example of how to <a href="#ChapterGetResource">get a Data Resource</a> you&#8217;ll find in the response
header the property 'Resource-Version' with a value of 1. If you scroll down to the second GET operation performed after updating the resource, you&#8217;ll see that 'Resource-Version' has been increased to 2. Additionally, a version number
larger than 0 tells you, that versioning is enabled. If not, the version number will be 0, whereas the initial version of a resource is 1.</p>
</div>
<div class="paragraph">
<p>Now, how can you benefit from this. At first, you might be interested to get all changes applied to a resource. The following request delivers this information. You simply refer to the resource for which you want to obtain audit information
and provide in the 'Accept' header the value 'application/vnd.datamanager.audit+json'.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1' -i -X GET \
    -H 'Accept: application/vnd.datamanager.audit+json'</code></pre>
</div>
</div>
<div class="paragraph">
<p>As a result you receive a list of changes in a format, which is proprietary to JaVers but which also contains all information in a clear JSON format. Changes are returned ordered by version in decreasing order.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
Resource-Version: 4
Content-Type: application/vnd.datamanager.audit+json;charset=UTF-8
Content-Length: 3341
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY

[ {
  "changeType" : "ValueChange",
  "globalId" : {
    "entity" : "edu.kit.datamanager.repo.domain.DataResource",
    "cdoId" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1"
  },
  "commitMetadata" : {
    "author" : "SELF",
    "properties" : [ ],
    "commitDate" : "2020-12-08T10:24:47.817",
    "commitDateInstant" : "2020-12-08T09:24:47.817296400Z",
    "id" : 4.0
  },
  "property" : "publisher",
  "propertyChangeType" : "PROPERTY_VALUE_CHANGED",
  "left" : "SELF",
  "right" : "KIT Data Manager"
}, {
  "changeType" : "ValueChange",
  "globalId" : {
    "entity" : "edu.kit.datamanager.repo.domain.DataResource",
    "cdoId" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1"
  },
  "commitMetadata" : {
    "author" : "SELF",
    "properties" : [ ],
    "commitDate" : "2020-12-08T10:24:47.817",
    "commitDateInstant" : "2020-12-08T09:24:47.817296400Z",
    "id" : 4.0
  },
  "property" : "lastUpdate",
  "propertyChangeType" : "PROPERTY_VALUE_CHANGED",
  "left" : "2020-12-08T09:24:47.612Z",
  "right" : "2020-12-08T09:24:47.814Z"
}, {
  "changeType" : "SetChange",
  "globalId" : {
    "entity" : "edu.kit.datamanager.repo.domain.DataResource",
    "cdoId" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1"
  },
  "commitMetadata" : {
    "author" : "SELF",
    "properties" : [ ],
    "commitDate" : "2020-12-08T10:24:47.619",
    "commitDateInstant" : "2020-12-08T09:24:47.619295900Z",
    "id" : 3.0
  },
  "property" : "alternateIdentifiers",
  "propertyChangeType" : "PROPERTY_VALUE_CHANGED",
  "elementChanges" : [ {
    "elementChangeType" : "ValueAdded",
    "index" : null,
    "value" : {
      "entity" : "edu.kit.datamanager.entities.Identifier",
      "cdoId" : 2
    }
  } ]
}, {
  "changeType" : "ValueChange",
  "globalId" : {
    "entity" : "edu.kit.datamanager.repo.domain.DataResource",
    "cdoId" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1"
  },
  "commitMetadata" : {
    "author" : "SELF",
    "properties" : [ ],
    "commitDate" : "2020-12-08T10:24:47.619",
    "commitDateInstant" : "2020-12-08T09:24:47.619295900Z",
    "id" : 3.0
  },
  "property" : "lastUpdate",
  "propertyChangeType" : "PROPERTY_VALUE_CHANGED",
  "left" : "2020-12-08T09:24:47.385Z",
  "right" : "2020-12-08T09:24:47.612Z"
}, {
  "changeType" : "ValueChange",
  "globalId" : {
    "entity" : "edu.kit.datamanager.repo.domain.DataResource",
    "cdoId" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1"
  },
  "commitMetadata" : {
    "author" : "SELF",
    "properties" : [ ],
    "commitDate" : "2020-12-08T10:24:47.389",
    "commitDateInstant" : "2020-12-08T09:24:47.389296600Z",
    "id" : 2.0
  },
  "property" : "publicationYear",
  "propertyChangeType" : "PROPERTY_VALUE_CHANGED",
  "left" : "2020",
  "right" : "2017"
}, {
  "changeType" : "ValueChange",
  "globalId" : {
    "entity" : "edu.kit.datamanager.repo.domain.DataResource",
    "cdoId" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1"
  },
  "commitMetadata" : {
    "author" : "SELF",
    "properties" : [ ],
    "commitDate" : "2020-12-08T10:24:47.389",
    "commitDateInstant" : "2020-12-08T09:24:47.389296600Z",
    "id" : 2.0
  },
  "property" : "lastUpdate",
  "propertyChangeType" : "PROPERTY_VALUE_CHANGED",
  "left" : "2020-12-08T09:24:46.671Z",
  "right" : "2020-12-08T09:24:47.385Z"
} ]</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example you can see three changes (starting with the last entry):</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The value of property publicationYear has been changed from 2019 (left) to 2017 (right) by the user with id SELF (which is the service itself as we are not using authentication). The result is version 2.</p>
</li>
<li>
<p>The set alternateIdentifiers has been changed by adding the value at index 2. The result is version 3.</p>
</li>
<li>
<p>The value of property publicationYear has been changed back from 2017 to 2019, resulting in the current version 4 of the resource.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Of course, the number of changes can be huge. Therfore, also the listing of audit information supports pagination as explained above for the basic examples.</p>
</div>
<div class="paragraph">
<p>Now, what about obtaining a specific version of a resource. This is done as shown in the next request.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">$ curl 'http://localhost:8080/api/v1/dataresources/683ae98f-a663-4dd9-8f20-0dcde71c37a1?version=2' -i -X GET</code></pre>
</div>
</div>
<div class="paragraph">
<p>The only thing you have to do is to add a query parameter with name 'version' and the value of the requested version to your GET request. As a result, you&#8217;ll receive the resource state at the specified version, which is
also stated by the 'Resource-Version' header.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "71195522"
Resource-Version: 2
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1002

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "SELF",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:47.385Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you omit the version argument, you always get the most recent version of the resource, in our example it&#8217;s version 4 as shown below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code data-lang="http" class="language-http hljs">HTTP/1.1 200 OK
ETag: "-205501225"
Resource-Version: 4
Content-Type: application/json
X-Content-Type-Options: nosniff
X-XSS-Protection: 1; mode=block
X-Frame-Options: DENY
Content-Length: 1105

{
  "id" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
  "identifier" : {
    "id" : 1,
    "value" : "(:tba)",
    "identifierType" : "DOI"
  },
  "creators" : [ {
    "id" : 1,
    "familyName" : "Doe",
    "givenName" : "John",
    "affiliations" : [ "Karlsruhe Institute of Technology" ]
  } ],
  "titles" : [ {
    "id" : 1,
    "value" : "Most basic resource for testing",
    "titleType" : "OTHER"
  } ],
  "publisher" : "KIT Data Manager",
  "publicationYear" : "2017",
  "resourceType" : {
    "id" : 1,
    "value" : "testingSample",
    "typeGeneral" : "DATASET"
  },
  "dates" : [ {
    "id" : 1,
    "value" : "2020-12-08T09:24:46Z",
    "type" : "CREATED"
  } ],
  "alternateIdentifiers" : [ {
    "id" : 2,
    "value" : "resource-1-231118",
    "identifierType" : "OTHER"
  }, {
    "id" : 1,
    "value" : "683ae98f-a663-4dd9-8f20-0dcde71c37a1",
    "identifierType" : "INTERNAL"
  } ],
  "lastUpdate" : "2020-12-08T09:24:47.814Z",
  "state" : "VOLATILE",
  "acls" : [ {
    "id" : 1,
    "sid" : "SELF",
    "permission" : "ADMINISTRATE"
  } ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>As mentioned at the beginning, versioning is supported for metadata resources, e.g. data resources and content information. There is currently no support for versioning of the actual content.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="trueremarks-on-working-with-versions"><a class="anchor" href="#trueremarks-on-working-with-versions"></a><a class="link" href="#trueremarks-on-working-with-versions">10. Remarks on Working with Versions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>While working with versions you should keep some particularities in mind. Access to version is only possible for single resources. There is e.g. no way to obtain all resources in version 2 from the server.
If a specific version of a resource is returned, the obtained ETag also relates to this specific version. Therefore, you should NOT use this ETag for any update operation as the operation will fail with response
code 412 (PRECONDITION FAILED). Consequently, it is also NOT allowed to modify a format version of a resource. If you want to rollback to a previous version, you should obtain the resource and submit a PUT request
of the entire document which will result in a new version equal to the previous state unless there were changes you are not allowed to apply (anymore), e.g. if permissions have changed.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-12-08 10:44:30 +0100
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
</body>
</html>